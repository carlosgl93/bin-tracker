var Y=r=>{throw TypeError(r)};var G=(r,t,i)=>t.has(r)||Y("Cannot "+i);var l=(r,t,i)=>(G(r,t,"read from private field"),i?i.call(r):t.get(r)),R=(r,t,i)=>t.has(r)?Y("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,i),B=(r,t,i,n)=>(G(r,t,"write to private field"),n?n.call(r,i):t.set(r,i),i),F=(r,t,i)=>(G(r,t,"access private method"),i);import{b as h,g as de,h as me,k as he,j as e,m as pe,n as be,o as V,p as ve,q as xe,P as I,H as Z}from"./deepmerge-DcrfCxJ9.js";import{T as x,a as ge,B as g,S as L,y as A}from"./App-BcHHTREt.js";import{g as je}from"./mutation-NL2UWmfx.js";import{S as fe,l as ye,i as ee,n as oe,x as Ne,b as Ce,w as Pe}from"./Grow-CvfDZcuL.js";import{a as Se,F as ke,T as u,b as Ee,c as Ie}from"./productionRecords-CrWnkucU.js";import{G as k,D as We}from"./Grid-3NuuvUVm.js";import"./index-CoP4CoC8.js";var O,w,j,W,T,H,J,ne,Te=(ne=class extends fe{constructor(t,i){super();R(this,T);R(this,O);R(this,w);R(this,j);R(this,W);B(this,O,t),this.setOptions(i),this.bindMethods(),F(this,T,H).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var n;const i=this.options;this.options=l(this,O).defaultMutationOptions(t),ye(this.options,i)||l(this,O).getMutationCache().notify({type:"observerOptionsUpdated",mutation:l(this,j),observer:this}),i!=null&&i.mutationKey&&this.options.mutationKey&&ee(i.mutationKey)!==ee(this.options.mutationKey)?this.reset():((n=l(this,j))==null?void 0:n.state.status)==="pending"&&l(this,j).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=l(this,j))==null||t.removeObserver(this)}onMutationUpdate(t){F(this,T,H).call(this),F(this,T,J).call(this,t)}getCurrentResult(){return l(this,w)}reset(){var t;(t=l(this,j))==null||t.removeObserver(this),B(this,j,void 0),F(this,T,H).call(this),F(this,T,J).call(this)}mutate(t,i){var n;return B(this,W,i),(n=l(this,j))==null||n.removeObserver(this),B(this,j,l(this,O).getMutationCache().build(l(this,O),this.options)),l(this,j).addObserver(this),l(this,j).execute(t)}},O=new WeakMap,w=new WeakMap,j=new WeakMap,W=new WeakMap,T=new WeakSet,H=function(){var i;const t=((i=l(this,j))==null?void 0:i.state)??je();B(this,w,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},J=function(t){oe.batch(()=>{var i,n,p,f,y,b,M,C;if(l(this,W)&&this.hasListeners()){const P=l(this,w).variables,S=l(this,w).context;(t==null?void 0:t.type)==="success"?((n=(i=l(this,W)).onSuccess)==null||n.call(i,t.data,P,S),(f=(p=l(this,W)).onSettled)==null||f.call(p,t.data,null,P,S)):(t==null?void 0:t.type)==="error"&&((b=(y=l(this,W)).onError)==null||b.call(y,t.error,P,S),(C=(M=l(this,W)).onSettled)==null||C.call(M,void 0,t.error,P,S))}this.listeners.forEach(P=>{P(l(this,w))})})},ne);function ze(r,t){const i=Ne(),[n]=h.useState(()=>new Te(i,r));h.useEffect(()=>{n.setOptions(r)},[n,r]);const p=h.useSyncExternalStore(h.useCallback(y=>n.subscribe(oe.batchCalls(y)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),f=h.useCallback((y,b)=>{n.mutate(y,b).catch(Ce)},[n]);if(p.error&&Pe(n.options.throwOnError,[p.error]))throw p.error;return{...p,mutate:f,mutateAsync:p.mutate}}function Oe(r){return me("MuiInputAdornment",r)}const te=de("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var se;const we=(r,t)=>{const{ownerState:i}=r;return[t.root,t[`position${V(i.position)}`],i.disablePointerEvents===!0&&t.disablePointerEvents,t[i.variant]]},Me=r=>{const{classes:t,disablePointerEvents:i,hiddenLabel:n,position:p,size:f,variant:y}=r,b={root:["root",i&&"disablePointerEvents",p&&`position${V(p)}`,y,n&&"hiddenLabel",f&&`size${V(f)}`]};return ve(b,Oe,t)},Re=pe("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:we})(xe(({theme:r})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(r.vars||r).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${te.positionStart}&:not(.${te.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),Be=h.forwardRef(function(t,i){const n=he({props:t,name:"MuiInputAdornment"}),{children:p,className:f,component:y="div",disablePointerEvents:b=!1,disableTypography:M=!1,position:C,variant:P,...S}=n,E=Se()||{};let D=P;P&&E.variant,E&&!D&&(D=E.variant);const v={...n,hiddenLabel:E.hiddenLabel,size:E.size,disablePointerEvents:b,position:C,variant:D},U=Me(v);return e.jsx(ke.Provider,{value:null,children:e.jsx(Re,{as:y,ownerState:v,className:be(U.root,f),ref:i,...S,children:typeof p=="string"&&!M?e.jsx(x,{color:"textSecondary",children:p}):e.jsxs(h.Fragment,{children:[C==="start"?se||(se=e.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):null,p]})})})}),ae=[{label:"Lunes",key:"lunes"},{label:"Martes",key:"martes"},{label:"Miércoles",key:"miercoles"},{label:"Jueves",key:"jueves"},{label:"Viernes",key:"viernes"}],ie=["09:00-10:00","10:00-11:00","11:00-12:00","12:00-13:00","13:00-14:00","14:00-15:00","15:00-16:00","16:00-17:00","17:00-18:00","18:00-19:00"],re=[{label:"Inicio",key:"inicio"},{label:"Chechito",key:"chechito"},{label:"Don Luis",key:"donluis"},{label:"Otros",key:"otros"}];function $e(){const r=ge(),[t,i]=h.useState(()=>new Date().toISOString().split("T")[0]),[n,p]=h.useState("11:30"),[f,y]=h.useState("19:00"),[b,M]=h.useState([{porcentaje:"",valor:""},{porcentaje:"",valor:""},{porcentaje:"",valor:""},{porcentaje:"",valor:""},{porcentaje:"",valor:""}]),[C,P]=h.useState(Array(10).fill("")),S=C.reduce((a,s)=>a+(s===""?0:Number(s)),0),[E,D]=h.useState(0),[v,U]=h.useState({inicial:"",usados:""}),[c,q]=h.useState({inicial:"",usadas:"",malas:""}),[z,Q]=h.useState({inicio:"",chechito:"",donluis:"",otros:"",malos:""}),[N,K]=h.useState({1:"",2:"",3:""}),[_,le]=h.useState(""),$=["inicio","chechito","donluis","otros"].reduce((a,s)=>a+(z[s]===""?0:Number(z[s])),0),X=$-E,ue=ze({mutationFn:async a=>{await Ie(a.date,a)},onSuccess:()=>{A.success("Registro de producción guardado exitosamente"),r("/",{state:{createdDate:t}})},onError:a=>{if(a instanceof Ee){if(a.code==="permission-denied"){A.error("No tienes permisos para guardar registros de producción");return}if(a.code==="unavailable"){A.error("El servicio de Firebase no está disponible. Inténtalo más tarde.");return}if(a.code==="not-found"){A.error("El registro de producción no fue encontrado. Verifica la fecha.");return}if(a.code==="invalid-argument"){A.error("Los datos proporcionados son inválidos. Verifica los campos.");return}}A.error(`Error al guardar el registro: ${a instanceof Error?a.message:"Desconocido"}`)}}),ce=a=>{a.preventDefault();const s=(Number(N[1])+Number(N[2])+Number(N[3]))/3,o={date:t,startTime:n,endTime:f,gasControl:ae.map((m,d)=>({day:m.label,percentage:b[d].porcentaje===""?0:Number(b[d].porcentaje),value:b[d].valor===""?0:Number(b[d].valor)})),drumProductionByHour:ie.map((m,d)=>({range:m,count:C[d]===""?0:Number(C[d])})),totalDrumsWeight:S*240,drumStock:{initial:v.inicial===""?0:Number(v.inicial),used:v.usados===""?0:Number(v.usados),total:(v.inicial===""?0:Number(v.inicial))-(v.usados===""?0:Number(v.usados))},bagStock:{initial:c.inicial===""?0:Number(c.inicial),used:c.usadas===""?0:Number(c.usadas),damaged:c.malas===""?0:Number(c.malas),total:(c.inicial===""?0:Number(c.inicial))-(c.usadas===""?0:Number(c.usadas))-(c.malas===""?0:Number(c.malas))},binsStatus:re.map(m=>({source:m.label,quantity:z[m.key]===""?0:Number(z[m.key])})),binsMalfunction:z.malos===""?0:Number(z.malos),totalExistence:$,totalProcessed:E,totalFinal:X,brix:{1:N[1]===""?0:Number(N[1]),2:N[2]===""?0:Number(N[2]),3:N[3]===""?0:Number(N[3]),average:isNaN(s)?0:s},comments:_.trim()||void 0};ue.mutate(o)};return e.jsx(g,{p:2,maxWidth:700,mx:"auto",children:e.jsxs("form",{onSubmit:ce,autoComplete:"off",children:[e.jsx(x,{variant:"h5",gutterBottom:!0,children:"Nuevo Registro de Producción"}),e.jsx(x,{variant:"body1",gutterBottom:!0,children:"Ingresa los datos de producción para el día seleccionado"}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",mb:2,children:"Fecha del Registro"}),e.jsx(u,{type:"date",label:"Fecha",value:t,onChange:a=>i(a.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})]}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Horarios del Proceso"}),e.jsxs(k,{container:!0,spacing:2,mt:1,children:[e.jsx(k,{item:!0,xs:6,children:e.jsx(u,{label:"Hora de Inicio",type:"time",value:n,onChange:a=>p(a.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(k,{item:!0,xs:6,children:e.jsx(u,{label:"Hora de Término",type:"time",value:f,onChange:a=>y(a.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})})]})]}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Tambores y Horarios"}),e.jsx(x,{variant:"body2",mb:1,children:"Ingresa la cantidad por cada hora (09:00 - 19:00)"}),e.jsx(k,{container:!0,spacing:2,children:ie.map((a,s)=>e.jsxs(k,{item:!0,xs:6,md:2.4,children:[e.jsx(x,{children:a}),e.jsx(u,{type:"number",value:C[s],onChange:o=>{const m=[...C],d=o.target.value;(d===""||Number(d)>=0)&&(m[s]=d),P(m)},fullWidth:!0,size:"small",inputProps:{min:0}})]},a))}),e.jsxs(L,{direction:"row",justifyContent:"space-between",alignContent:"center",mt:2,children:[e.jsxs(x,{fontWeight:"bold",children:[S*240," Kgs"]}),e.jsxs(x,{fontWeight:"bold",children:["Total: ",S]})]})]}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Stock de Tambores"}),e.jsxs(L,{direction:"column",spacing:2,mt:2,children:[e.jsx(g,{children:e.jsx(u,{label:"Stock Inicial",type:"number",value:v.inicial,onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&U(o=>({...o,inicial:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(g,{children:e.jsx(u,{label:"Tambores Usados",type:"number",value:v.usados,onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&U(o=>({...o,usados:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(g,{children:e.jsx(u,{label:"Total",value:(v.inicial===""?0:Number(v.inicial))-(v.usados===""?0:Number(v.usados)),fullWidth:!0,size:"small",InputProps:{readOnly:!0}})})]})]}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Stock de Bolsas"}),e.jsxs(L,{direction:"column",spacing:2,mt:2,children:[e.jsx(g,{children:e.jsx(u,{label:"Stock Inicial",type:"number",value:c.inicial,onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&q(o=>({...o,inicial:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(g,{children:e.jsx(u,{label:"Bolsas Usadas",type:"number",value:c.usadas,onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&q(o=>({...o,usadas:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(g,{children:e.jsx(u,{label:"Bolsas Malas",type:"number",value:c.malas,onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&q(o=>({...o,malas:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(g,{children:e.jsx(u,{label:"Total",value:(c.inicial===""?0:Number(c.inicial))-(c.usadas===""?0:Number(c.usadas))-(c.malas===""?0:Number(c.malas)),fullWidth:!0,size:"small",InputProps:{readOnly:!0}})})]})]}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Estado de Bins"}),e.jsxs(L,{direction:"column",gap:2,mt:2,children:[re.map(a=>e.jsx(g,{children:e.jsx(u,{label:a.label,type:"number",value:z[a.key],onChange:s=>{const o=s.target.value;(o===""||Number(o)>=0)&&Q(m=>({...m,[a.key]:o}))},fullWidth:!0,size:"small",inputProps:{min:0}})},a.key)),e.jsx(g,{children:e.jsx(u,{label:"Bins Malos",type:"number",value:z.malos,onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&Q(o=>({...o,malos:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})})]}),e.jsx(We,{sx:{my:2}}),e.jsxs(L,{direction:"column",spacing:2,mt:2,children:[e.jsx(k,{item:!0,xs:4,children:e.jsx(u,{type:"number",label:"Total Existencia",value:$,fullWidth:!0,size:"small",InputProps:{readOnly:!0}})}),e.jsx(k,{item:!0,xs:4,children:e.jsx(u,{label:"Total Procesados",value:E,fullWidth:!0,size:"small",onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&D(Number(s))}})}),e.jsx(k,{item:!0,xs:4,children:e.jsx(u,{label:"Total Final Proceso",value:X,fullWidth:!0,size:"small",InputProps:{readOnly:!0}})})]})]}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Brixs"}),e.jsxs(L,{direction:"column",spacing:2,mt:2,children:[e.jsx(g,{children:e.jsx(u,{label:"1",type:"number",value:N[1],onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&K(o=>({...o,1:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(g,{children:e.jsx(u,{label:"2",type:"number",value:N[2],onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&K(o=>({...o,2:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(g,{children:e.jsx(u,{label:"3",type:"number",value:N[3],onChange:a=>{const s=a.target.value;(s===""||Number(s)>=0)&&K(o=>({...o,3:s}))},fullWidth:!0,size:"small",inputProps:{min:0}})})]})]}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Control de Gas Diario"}),e.jsx(k,{container:!0,spacing:2,mt:1,children:ae.map((a,s)=>e.jsxs(k,{item:!0,xs:12,md:2.4,children:[e.jsx(x,{fontWeight:"bold",children:a.label}),e.jsx(u,{label:"Porcentaje",type:"number",value:b[s].porcentaje,onChange:o=>{const m=[...b],d=o.target.value;(d===""||Number(d)>=0)&&(m[s].porcentaje=d),M(m)},fullWidth:!0,InputProps:{endAdornment:e.jsx(Be,{position:"end",children:"%"}),inputProps:{min:0,step:"any"}},size:"small",sx:{mb:1},placeholder:""}),e.jsx(u,{label:"Valor",type:"number",value:b[s].valor,onChange:o=>{const m=[...b],d=o.target.value;(d===""||Number(d)>=0)&&(m[s].valor=d),M(m)},fullWidth:!0,size:"small",inputProps:{min:0,step:"any"}})]},a.key))})]}),e.jsxs(I,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Comentarios"}),e.jsx(u,{label:"Comentarios",multiline:!0,minRows:3,maxRows:6,value:_,onChange:a=>le(a.target.value),fullWidth:!0,size:"small",placeholder:"Agrega cualquier comentario adicional aquí..."})]}),e.jsxs(g,{display:"flex",justifyContent:"space-between",mt:3,children:[e.jsx(Z,{variant:"outlined",color:"secondary",href:"/",children:"Cancelar"}),e.jsx(Z,{variant:"contained",color:"primary",type:"submit",children:"Guardar Registro"})]})]})})}export{$e as default};
