var V=r=>{throw TypeError(r)};var H=(r,t,i)=>t.has(r)||V("Cannot "+i);var l=(r,t,i)=>(H(r,t,"read from private field"),i?i.call(r):t.get(r)),M=(r,t,i)=>t.has(r)?V("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,i),w=(r,t,i,n)=>(H(r,t,"write to private field"),n?n.call(r,i):t.set(r,i),i),R=(r,t,i)=>(H(r,t,"access private method"),i);import{b as v,g as ne,h as oe,k as le,j as e,m as ue,n as ce,o as K,p as de,q as me,P as O,J}from"./deepmerge-CtfbTrfU.js";import{T as x,b as he,B as Q,S as pe,y as F}from"./App--hkNGEiW.js";import{g as be}from"./mutation-d7Spxxid.js";import{S as ve,l as xe,i as _,n as ae,x as fe,b as je,w as ge}from"./QueryClientProvider-4gk7VEk7.js";import{u as ye,F as Ce,T as m,a as Ne,c as Pe}from"./productionRecords-DBpLK17S.js";import{G as u,D as Se}from"./Grid-CeCcs6ER.js";import"./index-BxQ4iiw8.js";var T,W,f,E,I,A,$,se,ke=(se=class extends ve{constructor(t,i){super();M(this,I);M(this,T);M(this,W);M(this,f);M(this,E);w(this,T,t),this.setOptions(i),this.bindMethods(),R(this,I,A).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var n;const i=this.options;this.options=l(this,T).defaultMutationOptions(t),xe(this.options,i)||l(this,T).getMutationCache().notify({type:"observerOptionsUpdated",mutation:l(this,f),observer:this}),i!=null&&i.mutationKey&&this.options.mutationKey&&_(i.mutationKey)!==_(this.options.mutationKey)?this.reset():((n=l(this,f))==null?void 0:n.state.status)==="pending"&&l(this,f).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=l(this,f))==null||t.removeObserver(this)}onMutationUpdate(t){R(this,I,A).call(this),R(this,I,$).call(this,t)}getCurrentResult(){return l(this,W)}reset(){var t;(t=l(this,f))==null||t.removeObserver(this),w(this,f,void 0),R(this,I,A).call(this),R(this,I,$).call(this)}mutate(t,i){var n;return w(this,E,i),(n=l(this,f))==null||n.removeObserver(this),w(this,f,l(this,T).getMutationCache().build(l(this,T),this.options)),l(this,f).addObserver(this),l(this,f).execute(t)}},T=new WeakMap,W=new WeakMap,f=new WeakMap,E=new WeakMap,I=new WeakSet,A=function(){var i;const t=((i=l(this,f))==null?void 0:i.state)??be();w(this,W,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},$=function(t){ae.batch(()=>{var i,n,h,j,g,p,z,y;if(l(this,E)&&this.hasListeners()){const C=l(this,W).variables,P=l(this,W).context;(t==null?void 0:t.type)==="success"?((n=(i=l(this,E)).onSuccess)==null||n.call(i,t.data,C,P),(j=(h=l(this,E)).onSettled)==null||j.call(h,t.data,null,C,P)):(t==null?void 0:t.type)==="error"&&((p=(g=l(this,E)).onError)==null||p.call(g,t.error,C,P),(y=(z=l(this,E)).onSettled)==null||y.call(z,void 0,t.error,C,P))}this.listeners.forEach(C=>{C(l(this,W))})})},se);function Ee(r,t){const i=fe(),[n]=v.useState(()=>new ke(i,r));v.useEffect(()=>{n.setOptions(r)},[n,r]);const h=v.useSyncExternalStore(v.useCallback(g=>n.subscribe(ae.batchCalls(g)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),j=v.useCallback((g,p)=>{n.mutate(g,p).catch(je)},[n]);if(h.error&&ge(n.options.throwOnError,[h.error]))throw h.error;return{...h,mutate:j,mutateAsync:h.mutate}}function Ie(r){return oe("MuiInputAdornment",r)}const X=ne("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var Y;const Te=(r,t)=>{const{ownerState:i}=r;return[t.root,t[`position${K(i.position)}`],i.disablePointerEvents===!0&&t.disablePointerEvents,t[i.variant]]},We=r=>{const{classes:t,disablePointerEvents:i,hiddenLabel:n,position:h,size:j,variant:g}=r,p={root:["root",i&&"disablePointerEvents",h&&`position${K(h)}`,g,n&&"hiddenLabel",j&&`size${K(j)}`]};return de(p,Ie,t)},ze=ue("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:Te})(me(({theme:r})=>({display:"flex",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(r.vars||r).palette.action.active,variants:[{props:{variant:"filled"},style:{[`&.${X.positionStart}&:not(.${X.hiddenLabel})`]:{marginTop:16}}},{props:{position:"start"},style:{marginRight:8}},{props:{position:"end"},style:{marginLeft:8}},{props:{disablePointerEvents:!0},style:{pointerEvents:"none"}}]}))),Oe=v.forwardRef(function(t,i){const n=le({props:t,name:"MuiInputAdornment"}),{children:h,className:j,component:g="div",disablePointerEvents:p=!1,disableTypography:z=!1,position:y,variant:C,...P}=n,S=ye()||{};let B=C;C&&S.variant,S&&!B&&(B=S.variant);const b={...n,hiddenLabel:S.hiddenLabel,size:S.size,disablePointerEvents:p,position:y,variant:B},L=We(b);return e.jsx(Ce.Provider,{value:null,children:e.jsx(ze,{as:g,ownerState:b,className:ce(L.root,j),ref:i,...P,children:typeof h=="string"&&!z?e.jsx(x,{color:"textSecondary",children:h}):e.jsxs(v.Fragment,{children:[y==="start"?Y||(Y=e.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):null,h]})})})}),Z=[{label:"Lunes",key:"lunes"},{label:"Martes",key:"martes"},{label:"Miércoles",key:"miercoles"},{label:"Jueves",key:"jueves"},{label:"Viernes",key:"viernes"}],ee=["09:00-10:00","10:00-11:00","11:00-12:00","12:00-13:00","13:00-14:00","14:00-15:00","15:00-16:00","16:00-17:00","17:00-18:00","18:00-19:00"],te=[{label:"Inicio",key:"inicio"},{label:"Chechito",key:"chechito"},{label:"Don Luis",key:"donluis"},{label:"Otros",key:"otros"}];function Ue(){const r=he(),[t,i]=v.useState(()=>new Date().toISOString().split("T")[0]),[n,h]=v.useState("09:20"),[j,g]=v.useState("19:00"),[p,z]=v.useState([{porcentaje:"",valor:""},{porcentaje:"",valor:""},{porcentaje:"",valor:""},{porcentaje:"",valor:""},{porcentaje:"",valor:""}]),[y,C]=v.useState(Array(10).fill("")),P=y.reduce((s,a)=>s+(a===""?0:Number(a)),0),[S,B]=v.useState(0),[b,L]=v.useState({inicial:"",usados:""}),[c,D]=v.useState({inicial:"",usadas:"",malas:""}),[k,G]=v.useState({inicio:"",chechito:"",donluis:"",otros:"",malos:""}),U=["inicio","chechito","donluis","otros","malos"].reduce((s,a)=>s+(k[a]===""?0:Number(k[a])),0),q=U-S-Number(k.malos),ie=Ee({mutationFn:async s=>{await Pe(s.date,s)},onSuccess:()=>{F.success("Registro de producción guardado exitosamente"),r("/",{state:{createdDate:t}})},onError:s=>{if(s instanceof Ne){if(s.code==="permission-denied"){F.error("No tienes permisos para guardar registros de producción");return}if(s.code==="unavailable"){F.error("El servicio de Firebase no está disponible. Inténtalo más tarde.");return}if(s.code==="not-found"){F.error("El registro de producción no fue encontrado. Verifica la fecha.");return}if(s.code==="invalid-argument"){F.error("Los datos proporcionados son inválidos. Verifica los campos.");return}}F.error(`Error al guardar el registro: ${s instanceof Error?s.message:"Desconocido"}`)}}),re=s=>{s.preventDefault();const a={date:t,startTime:n,endTime:j,gasControl:Z.map((o,d)=>({day:o.label,percentage:p[d].porcentaje===""?0:Number(p[d].porcentaje),value:p[d].valor===""?0:Number(p[d].valor)})),drumProductionByHour:ee.map((o,d)=>({range:o,count:y[d]===""?0:Number(y[d])})),drumStock:{initial:b.inicial===""?0:Number(b.inicial),used:b.usados===""?0:Number(b.usados),total:(b.inicial===""?0:Number(b.inicial))-(b.usados===""?0:Number(b.usados))},bagStock:{initial:c.inicial===""?0:Number(c.inicial),used:c.usadas===""?0:Number(c.usadas),damaged:c.malas===""?0:Number(c.malas),total:(c.inicial===""?0:Number(c.inicial))-(c.usadas===""?0:Number(c.usadas))-(c.malas===""?0:Number(c.malas))},binsStatus:te.map(o=>({source:o.label,quantity:k[o.key]===""?0:Number(k[o.key])})),binsMalfunction:k.malos===""?0:Number(k.malos),totalExistence:U,totalProcessed:S,totalFinal:q};ie.mutate(a)};return e.jsx(Q,{p:2,maxWidth:700,mx:"auto",children:e.jsxs("form",{onSubmit:re,autoComplete:"off",children:[e.jsx(x,{variant:"h5",gutterBottom:!0,children:"Nuevo Registro de Producción"}),e.jsx(x,{variant:"body1",gutterBottom:!0,children:"Ingresa los datos de producción para el día seleccionado"}),e.jsxs(O,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Fecha del Registro"}),e.jsx(m,{type:"date",label:"Fecha",value:t,onChange:s=>i(s.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})]}),e.jsxs(O,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Horarios del Proceso"}),e.jsxs(u,{container:!0,spacing:2,mt:1,children:[e.jsx(u,{item:!0,xs:6,children:e.jsx(m,{label:"Hora de Inicio",type:"time",value:n,onChange:s=>h(s.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(m,{label:"Hora de Término",type:"time",value:j,onChange:s=>g(s.target.value),fullWidth:!0,InputLabelProps:{shrink:!0}})})]})]}),e.jsxs(O,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Tambores y Horarios"}),e.jsx(x,{variant:"body2",mb:1,children:"Ingresa la cantidad por cada hora (09:00 - 19:00)"}),e.jsx(u,{container:!0,spacing:2,children:ee.map((s,a)=>e.jsxs(u,{item:!0,xs:6,md:2.4,children:[e.jsx(x,{children:s}),e.jsx(m,{type:"number",value:y[a],onChange:o=>{const d=[...y],N=o.target.value;(N===""||Number(N)>=0)&&(d[a]=N),C(d)},fullWidth:!0,size:"small",inputProps:{min:0}})]},s))}),e.jsxs(pe,{direction:"row",justifyContent:"space-between",alignContent:"center",mt:2,children:[e.jsxs(x,{fontWeight:"bold",children:[P*240," Kgs"]}),e.jsxs(x,{fontWeight:"bold",children:["Total: ",P]})]})]}),e.jsxs(O,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Stock de Tambores"}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:4,children:e.jsx(m,{label:"Stock Inicial",type:"number",value:b.inicial,onChange:s=>{const a=s.target.value;(a===""||Number(a)>=0)&&L(o=>({...o,inicial:a}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(u,{item:!0,xs:4,children:e.jsx(m,{label:"Tambores Usados",type:"number",value:b.usados,onChange:s=>{const a=s.target.value;(a===""||Number(a)>=0)&&L(o=>({...o,usados:a}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(u,{item:!0,xs:4,children:e.jsx(m,{label:"Total",value:(b.inicial===""?0:Number(b.inicial))-(b.usados===""?0:Number(b.usados)),fullWidth:!0,size:"small",InputProps:{readOnly:!0}})})]})]}),e.jsxs(O,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Stock de Bolsas"}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:3,children:e.jsx(m,{label:"Stock Inicial",type:"number",value:c.inicial,onChange:s=>{const a=s.target.value;(a===""||Number(a)>=0)&&D(o=>({...o,inicial:a}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(m,{label:"Bolsas Usadas",type:"number",value:c.usadas,onChange:s=>{const a=s.target.value;(a===""||Number(a)>=0)&&D(o=>({...o,usadas:a}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(m,{label:"Bolsas Malas",type:"number",value:c.malas,onChange:s=>{const a=s.target.value;(a===""||Number(a)>=0)&&D(o=>({...o,malas:a}))},fullWidth:!0,size:"small",inputProps:{min:0}})}),e.jsx(u,{item:!0,xs:3,children:e.jsx(m,{label:"Total",value:(c.inicial===""?0:Number(c.inicial))-(c.usadas===""?0:Number(c.usadas))-(c.malas===""?0:Number(c.malas)),fullWidth:!0,size:"small",InputProps:{readOnly:!0}})})]})]}),e.jsxs(O,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Estado de Bins"}),e.jsxs(u,{container:!0,spacing:2,children:[te.map(s=>e.jsx(u,{item:!0,xs:6,md:2.4,children:e.jsx(m,{label:s.label,type:"number",value:k[s.key],onChange:a=>{const o=a.target.value;(o===""||Number(o)>=0)&&G(d=>({...d,[s.key]:o}))},fullWidth:!0,size:"small",inputProps:{min:0}})},s.key)),e.jsx(u,{item:!0,xs:6,md:2.4,children:e.jsx(m,{label:"Bins Malos",type:"number",value:k.malos,onChange:s=>{const a=s.target.value;(a===""||Number(a)>=0)&&G(o=>({...o,malos:a}))},fullWidth:!0,size:"small",inputProps:{min:0}})})]}),e.jsx(Se,{sx:{my:2}}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:4,children:e.jsx(m,{type:"number",label:"Total Existencia",value:U,fullWidth:!0,size:"small",InputProps:{readOnly:!0}})}),e.jsx(u,{item:!0,xs:4,children:e.jsx(m,{label:"Total Procesados",value:S,fullWidth:!0,size:"small",onChange:s=>{const a=s.target.value;(a===""||Number(a)>=0)&&B(Number(a))}})}),e.jsx(u,{item:!0,xs:4,children:e.jsx(m,{label:"Total Final Proceso",value:q,fullWidth:!0,size:"small",InputProps:{readOnly:!0}})})]})]}),e.jsxs(O,{variant:"outlined",sx:{p:2,mb:2},children:[e.jsx(x,{variant:"subtitle2",children:"Control de Gas Diario"}),e.jsx(u,{container:!0,spacing:2,mt:1,children:Z.map((s,a)=>e.jsxs(u,{item:!0,xs:12,md:2.4,children:[e.jsx(x,{fontWeight:"bold",children:s.label}),e.jsx(m,{label:"Porcentaje",type:"number",value:p[a].porcentaje,onChange:o=>{const d=[...p],N=o.target.value;(N===""||Number(N)>=0)&&(d[a].porcentaje=N),z(d)},fullWidth:!0,InputProps:{endAdornment:e.jsx(Oe,{position:"end",children:"%"}),inputProps:{min:0,step:"any"}},size:"small",sx:{mb:1},placeholder:""}),e.jsx(m,{label:"Valor",type:"number",value:p[a].valor,onChange:o=>{const d=[...p],N=o.target.value;(N===""||Number(N)>=0)&&(d[a].valor=N),z(d)},fullWidth:!0,size:"small",inputProps:{min:0,step:"any"}})]},s.key))})]}),e.jsxs(Q,{display:"flex",justifyContent:"space-between",mt:3,children:[e.jsx(J,{variant:"outlined",color:"secondary",href:"/daily",children:"Cancelar"}),e.jsx(J,{variant:"contained",color:"primary",type:"submit",children:"Guardar Registro"})]})]})})}export{Ue as default};
